#+AUTHOR: Tony
#+STARTUP: overview

* Table of Contents :toc:
- [[#oxwm][OXWM]]
- [[#installation][Installation]]
  - [[#arch-linux][Arch Linux]]
  - [[#building-from-source][Building from Source]]
  - [[#setting-up-oxwm][Setting up OXWM]]
- [[#configuration][Configuration]]
- [[#contributing][Contributing]]
- [[#key-bindings][Key Bindings]]
- [[#features][Features]]
- [[#testing-with-xephyr][Testing with Xephyr]]
- [[#project-structure][Project Structure]]
- [[#architecture-notes][Architecture Notes]]
- [[#development-roadmap][Development Roadmap]]
- [[#license][License]]

* OXWM — DWM but Better (and oxidized)
A dynamic window manager written in Rust, inspired by dwm but designed to evolve
on its own. Configuration is done in Rust source code, keeping with the suckless
philosophy of *"edit + recompile."*, but with sane defaults and no arbitrary elitism
enforcing bad variable names and bad file structure topology.

* Installation
** Arch Linux
Install dependencies:
#+begin_src sh
sudo pacman -S rust cargo libx11 libxft freetype2 fontconfig pkg-config
#+end_src

** Building from Source
#+begin_src sh
git clone https://github.com/tonybanters/oxwm
cd oxwm
cargo build --release
sudo cp target/release/oxwm /usr/local/bin/
#+end_src

Or use the justfile:
#+begin_src sh
just install
#+end_src

** Setting up OXWM
Add the following to your =~/.xinitrc=:
#+begin_src sh
exec oxwm
#+end_src

Then start X with:
#+begin_src sh
startx
#+end_src

* Configuration
OXWM follows the suckless philosophy: configuration is done by editing =src/config.rs= and recompiling.

On first build, =config.rs= is automatically created from =src/default_config.rs=. Your =config.rs= is gitignored, so you can customize it without worrying about merge conflicts.

To reset your config to defaults:
#+begin_src sh
just reset-config
#+end_src

Edit =src/config.rs= to customize:
- Keybindings
- Colors and appearance
- Status bar blocks
- Gaps and borders
- Terminal and applications

After making changes:
#+begin_src sh
just install
#+end_src

Then reload OXWM with Alt+Shift+R.

* Contributing
When contributing to OXWM:

1. Never commit your personal =src/config.rs= (it's gitignored)
2. Only modify =src/default_config.rs= if adding new configuration options
3. Test your changes with =just test= using Xephyr
4. Document any new features or keybindings

* Key Bindings
Default keybindings (customizable in config.rs):

| Binding         | Action                  |
|-----------------+-------------------------|
| Alt+Return      | Spawn terminal          |
| Alt+J/K         | Cycle focus down/up     |
| Alt+Q           | Kill focused window     |
| Alt+Shift+Q     | Quit WM                 |
| Alt+Shift+R     | Hot reload WM           |
| Alt+1-9         | View tag 1-9            |
| Alt+Shift+1-9   | Move window to tag 1-9  |
| Alt+S           | Screenshot (maim)       |
| Alt+D           | dmenu launcher          |
| Alt+A           | Toggle gaps             |
| Alt+Shift+F     | Toggle fullscreen       |

* Features
- Dynamic tiling layout with master/stack
- Tag-based workspaces (9 tags by default)
- Configurable gaps between windows
- Status bar with modular block system
  - Battery, RAM, datetime, shell commands
  - Custom colors and update intervals
  - Click-to-switch tags
- Window focus cycling
- Hot reload without restarting X
- Persistent window tags across restarts
- Mouse hover to focus
- Border indicators for focused windows
- Fullscreen mode

* Testing with Xephyr
Test OXWM in a nested X server without affecting your current session:

#+begin_src sh
just test
#+end_src

This starts Xephyr on display :1 and launches OXWM inside it.

Or manually:
#+begin_src sh
Xephyr -screen 1280x800 :1 &
DISPLAY=:1 cargo run
#+end_src

* Project Structure
#+begin_src sh
src/
├── main.rs
│   └── main()
│       └── Creates WindowManager and calls .run()
│
├── window_manager.rs                    [CORE - X11 event handling]
│   ├── struct WindowManager
│   │   ├── connection: RustConnection   [X11 connection]
│   │   ├── windows: Vec<Window>         [All managed windows]
│   │   ├── focused_window: Option<Window>
│   │   ├── layout: Box<dyn Layout>
│   │   ├── window_tags: HashMap<Window, TagMask>
│   │   ├── selected_tags: TagMask
│   │   └── bar: Bar                     [Status bar]
│   │
│   ├── new()                            [Initialize WM, grab root, restore tags, scan windows]
│   ├── run()                            [Main event loop with block updates]
│   ├── handle_event()                   [Route X11 events]
│   │   ├── MapRequest    → add window, apply layout, update bar, save tag
│   │   ├── UnmapNotify   → remove window, update bar
│   │   ├── DestroyNotify → remove window, update bar
│   │   ├── KeyPress      → get action, handle it (includes Restart)
│   │   ├── ButtonPress   → handle bar clicks
│   │   └── Expose        → redraw bar
│   ├── handle_key_action()              [Execute keyboard actions]
│   ├── get_saved_selected_tags()        [Restore selected tags from _NET_CURRENT_DESKTOP]
│   ├── save_selected_tags()             [Persist selected tags to root window]
│   ├── get_saved_tag()                  [Restore window tag from _NET_CLIENT_INFO]
│   ├── save_client_tag()                [Persist window tag to window property]
│   ├── scan_existing_windows()          [Manage windows on startup]
│   ├── remove_window()                  [Remove from Vec, reapply layout]
│   ├── set_focus()                      [Focus window, update visuals]
│   ├── cycle_focus()                    [Move focus to next/prev window]
│   ├── view_tag()                       [Switch to tag/workspace, update visibility]
│   ├── move_to_tag()                    [Move window to tag]
│   ├── update_bar()                     [Calculate occupied tags, redraw bar]
│   ├── update_focus_visuals()           [Set border colors]
│   ├── update_window_visibility()       [Map/unmap windows based on tags]
│   └── apply_layout()                   [Position all windows below bar]
│
├── config.rs                            [CONFIGURATION - all settings here]
│   ├── BORDER_WIDTH, BORDER_FOCUSED, BORDER_UNFOCUSED
│   ├── FONT                             [XFT font string]
│   ├── TAG_COUNT, TAGS                  [Workspace configuration]
│   ├── TERMINAL, MODKEY
│   ├── ColorScheme                      [Foreground, background, border colors]
│   ├── SCHEME_NORMAL, SCHEME_OCCUPIED, SCHEME_SELECTED
│   ├── KEYBINDINGS                      [All keybinds as const array]
│   └── STATUS_BLOCKS                    [Block configurations with format, command, interval]
│
├── bar/
│   ├── mod.rs                           [Re-exports: Bar, BlockCommand, BlockConfig]
│   ├── bar.rs
│   │   ├── struct Bar                   [Status bar window with XFT support]
│   │   ├── new()                        [Create bar X11 window, load font, init blocks]
│   │   ├── draw()                       [Render tags + blocks with underlines]
│   │   ├── update_blocks()              [Update block content based on intervals]
│   │   ├── handle_click()               [Detect which tag was clicked]
│   │   └── invalidate()                 [Mark bar as needing redraw]
│   ├── font.rs
│   │   ├── struct Font                  [XFT font wrapper]
│   │   ├── struct FontDraw              [XFT drawing context]
│   │   └── draw_text()                  [Render text with color]
│   └── blocks/
│       ├── mod.rs                       [Block trait, BlockConfig, BlockCommand enum]
│       ├── battery.rs                   [Battery status block]
│       ├── datetime.rs                  [Date/time formatting block]
│       └── shell.rs                     [Shell command execution block]
│
├── keyboard/
│   ├── mod.rs                           [Re-exports]
│   ├── keycodes.rs                      [Key constants: Q, J, RETURN, etc]
│   └── handlers.rs
│       ├── enum KeyAction               [Spawn, KillClient, FocusStack, ViewTag, Restart, etc]
│       ├── enum Arg                     [None, Int, Str, Array]
│       ├── struct Key                   [Keybinding definition]
│       ├── setup_keybinds()             [Register keys with X11]
│       └── handle_key_press()           [Parse KeyPressEvent → KeyAction]
│
└── layout/
    ├── mod.rs                           [Layout trait definition]
    └── tiling.rs
        └── TilingLayout::arrange()      [Calculate window positions]c
#+end_src

* Architecture Notes
** Tag System
Tags are implemented as bitmasks (TagMask = u32), allowing windows to belong to multiple tags simultaneously. Each window has an associated TagMask stored in a HashMap. Tags persist across WM restarts using X11 properties (_NET_CURRENT_DESKTOP for selected tags, _NET_CLIENT_INFO for per-window tags).

** Status Bar
The bar uses a performance-optimized approach with a modular block system:
- Only redraws when invalidated
- Pre-calculates tag widths on creation
- Blocks update independently based on their configured intervals
- Supports custom colors and underline indicators
- Easily extensible - add new block types in src/bar/blocks/

** Layout System
The tiling layout divides the screen into a master area (left half) and stack area (right half). The master window occupies the full height of the master area, while stack windows split the stack area vertically. Gaps are configurable and can be toggled at runtime.

* Development Roadmap
** Current Focus
- Multi-monitor support
- Additional layouts (monocle, floating)
- Master area resizing
- Window swapping in layout

** Future Enhancements
- Per-window floating behavior
- Per-program rules (auto-tag assignment, floating rules)
- External bar support (polybar, lemonbar)
- Scratchpad functionality
- Window minimize/restore

* License
[[https://www.gnu.org/licenses/gpl-3.0.en.html][GPL v3]]
